<html>
<head>
<!-- import some shit -->
</head>
<body>

<div>

<canvas id="mrcanvas">

</canvas>

</div>

<div>
<h4>
Intructerinos
</h4>
<p>
	Left click selects a triangles or move the path nodes
<p>
<p>
	Right click adds a vertex to the graph
<p>
<p>
	Shift (or Control) + click toggles pathability of a triangle
<p>
</div>

<script type="text/javascript">

Array.prototype.remove = function(val) {
    for (var i = 0; i < this.length; i++) {
        if (this[i] === val) {
            this.splice(i, 1);
            i--;
        }
    }
    return this;
}

Math.hypot = Math.hypot || function(x, y) {
  return Math.sqrt(x*x + y*y);
};

//magic constants
var TOPLEFT = { x: 0, y: 0 };
var TOPRIGHT = { x: 500, y: 0 };
var BOTTOMLEFT = { x: 0, y: 500 };
var BOTTOMRIGHT = { x: 500, y: 500 };

//variable names no longer refer to color within
var LIGHTLIGHTBLUE = '#87CEEB';
var LIGHTBLUE = '#169D5B';
var DARKBLUE = '#513317';
var LIGHTYELLOW = '#FFF176';
var LIGHTRED = '#F01A24';
var LIGHTORANGE = '#F15A23';
var BLACK = '#181B19';

var c=document.getElementById("mrcanvas");
c.width = TOPRIGHT.x;
c.height = BOTTOMLEFT.y;
c.oncontextmenu = function (e) {
    e.preventDefault();
};

var PathVertices = [ 
{
	x: TOPLEFT.x + 40,
	y: TOPRIGHT.y + 40
}, 
{
	x: BOTTOMRIGHT.x - 40,
	y: BOTTOMRIGHT.y - 40
}
];

var DraggingNode = null;

var MouseDown = function(e) {
	var x = e.pageX;
	var y = e.pageY;
	var vertex = { x: x - c.offsetLeft, y: y - c.offsetTop};
	
	//toggle triangle pathability
	if(e.shiftKey || e.ctrlKey) {
		TogglePathability(vertex);		
		return;
	}
	
	//left click
	if(e.button === 0) {
		var pathNode = GetPathNodeSelection(vertex);
		//check if grabbing a pathnode
		if(pathNode != null) {
			DraggingPathNode = pathNode;
		} else {
			SelectTriangle(vertex);
		}
	}
	
	//right click
	if(e.button === 2) {
		AddVertex(vertex);
		DrawTriangles();
	}
}

var MouseUp = function(e) {
	if(DraggingPathNode != null) {
		DraggingPathNode = null;
		DrawTriangles();
		FindPath(PathVertices[0], PathVertices[1]);
		FindGridPath(PathVertices[0], PathVertices[1]);
	}
}

var MouseMove = function(e) {
	var x = e.pageX;
	var y = e.pageY;
	var vertex = { x: x - c.offsetLeft, y: y - c.offsetTop};
	
	if(DraggingPathNode != null) {
		DraggingPathNode.x = vertex.x;
		DraggingPathNode.y = vertex.y;
		DrawTriangles();
	}
}

var MouseLeave = function(e) {
	DraggingPathNode = null;
}

c.addEventListener("mousedown", MouseDown, false);
c.addEventListener("mousemove", MouseMove, false);
c.addEventListener("mouseup", MouseUp, false);
c.addEventListener("mouseleave", MouseLeave, false);
var Ctx=c.getContext("2d");
Ctx.lineWidth = 2;

var DrawRectangle = function(quad, highlight) {
	if(highlight) {
		Ctx.strokeStyle = LIGHTYELLOW;
	} else {
		Ctx.strokeStyle = LIGHTBLUE;
	}

	Ctx.beginPath();

	Ctx.moveTo(quad.minx, quad.miny);
	Ctx.lineTo(quad.maxx, quad.miny);
	Ctx.lineTo(quad.maxx, quad.maxy);
	Ctx.lineTo(quad.minx, quad.maxy);
	Ctx.lineTo(quad.minx, quad.miny);

	Ctx.closePath();

	if(!quad.revealed) {
		Ctx.fillStyle = DARKBLUE;
		Ctx.fill();
	}
	Ctx.stroke();
}

var DrawLines = function(path, color) {
	Ctx.strokeStyle = LIGHTORANGE;
	if(color) {
		Ctx.strokeStyle = color;
	}
	Ctx.beginPath();
	Ctx.moveTo(path[0].x, path[0].y);
	for(var i = 1; i < path.length; i++) {
		Ctx.lineTo(path[i].x, path[i].y);
	}
	Ctx.stroke();
	Ctx.closePath();
}

var DrawNodes = function() {
	for(var i = 0; i < 2; i++) {
		Ctx.beginPath();
		Ctx.strokeStyle = BLACK;
		Ctx.fillStyle = DARKBLUE;
		Ctx.arc(PathVertices[i].x, PathVertices[i].y, 10, 0, 2 * Math.PI, false);
		Ctx.stroke();
		Ctx.fill();
		Ctx.closePath();
	}
}

var DrawText = function(text, y) {
	var x = 30;
	Ctx.font = "bold 20px Arial";
	Ctx.strokeStyle = 'black';
	Ctx.lineWidth = 3;
	Ctx.strokeText(text, x, y);
	Ctx.fillStyle = 'white';
	Ctx.fillText(text, x, y);
}

var GetNodeSelection = function(vertex) {
	for(var i = 0; i < 2; i++) {
		if(Math.hypot(PathVertices[i].x - vertex.x, PathVertices[i].y - vertex.y) < 11) {
			return PathVertices[i];
		}
	}
}

</script>

<script type="text/javascript">

//root quad
var Root;

//quadtree object 
var QuadTree = function(minx, miny, maxx, maxy, parent) {
	this.minx = minx;
	this.miny = miny;
	this.maxx = maxx;
	this.maxy = maxy;
	this.children = [];
	this.revealed = false;
	this.parent = parent;
}
//v for vertexxa
QuadTree.prototype.ContainsPoint = function(v) {
	return (v.x <= maxx && v.x > minx && x.y <= maxy && v.y > miny);
}




var GetQuad = function(vertex) {
	for(var i = 0; i < Triangles.length; i++) {
		if(Triangles[i].IsVertexInside(vertex)) {
			return Triangles[i];
		}
	}
	return null;
}

var Initialize = function() {

Root = new QuadTree() {
	this.minx = 0;
	this.miny = 0;
	this.maxx = 500;
	this.maxy = 500;
	this.children = [];
};

RenderScene();

}

window.onload = function() {
	Initialize();
}

</script>

<style type="text/css">

#mrcanvas {
	width: 800px;;
	height: 600px;
}

</style>


</body>
</html>